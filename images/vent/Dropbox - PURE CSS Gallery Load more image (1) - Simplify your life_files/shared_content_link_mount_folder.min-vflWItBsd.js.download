define(["require","exports","tslib","modules/clean/browse_interface","modules/clean/multiaccount_login","modules/clean/sharing/api/client","modules/clean/api_v2/user_client","modules/clean/sharing/role_selector_modal","modules/clean/sharing/ui_notifications_util","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/clean/flux/dispatcher","modules/clean/sharing/share_page/action_types","modules/clean/sharing/shared_content_link_handle_folder_mount_done"],(function(e,o,r,i,t,a,s,n,l,d,u,_,c,f,m,g){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),i=r.__importStar(i),t=r.__importDefault(t),u=r.__importStar(u),o.mountSharedFolder=function e(o,r,p,h,b,v,y,w){void 0===b&&(b=!1),void 0===v&&(v=null),void 0===y&&(y=!1);var M,E=d.Viewer.get_viewer();if(r)E.is_role_signed_in(r)||t.default.show_modal({role:r,on_success:function(){e(o,r,p,h,!1,null,y,w)}});else if(E.is_paired){new n.RoleSelectorModal((function(r){e(o,r,p="PREVIEW_PAGE",h,!1,null,y,w)})).show()}if(r){var S=E.get_uid_by_role(r);_.assert(!!S,"selected role should have corresponding uid"),M=S||-1}else _.assert(!E.is_paired,"role can not be unspecified for paired viewer"),M=E.get_user_ids()[0];var D=c.intl.formatMessage({id:"Zd8jt8",defaultMessage:"Adding to your Dropbox..."});E.is_paired&&(D=E.get_user_by_id(M).is_team?c.intl.formatMessage({id:"PTGTT4",defaultMessage:"Adding to your {team_name} Dropbox..."},{team_name:E.team_name}):c.intl.formatMessage({id:"IVdsoO",defaultMessage:"Adding to your personal Dropbox..."})),l.sharingNotificationSuccess(D);var x=new a.FolderShareApiClient({userId:M,client:new s.UserApiV2Client});f.Dispatcher.dispatch({type:m.SharePageActionTypes.MOUNT_FOLDER_REQUEST,metadata:w,user:E.get_user_by_id(M)}),x.mount({contentId:o}).then((function(e){y&&!h?g.handleFolderMountDone(E.get_user_by_id(M),e,w.is_team_folder,w.can_mount||!1,w.folder_size,w.permissions):(function(e){if(e){var o=e;v&&(o+=v.ns_path);var r=E.get_user_by_id(M),t=i.browse_uri_for_fq_path(r,o),a=b?"1":"0";t.updateQuery({from_scl_sync_modal:a}),u.redirect(t.toString())}})(e.path_lower)})).catch((function(e){e&&e.error&&"insufficient_quota"===e.error[".tag"]?l.sharingNotificationError(c.intl.formatMessage({id:"jENkzW",defaultMessage:"Canâ€™t add folder. Your Dropbox account is full."})):l.sharingNotificationError(c.intl.formatMessage({id:"EQfnGr",defaultMessage:"We were unable to complete your request."}))}))}}));
//# sourceMappingURL=shared_content_link_mount_folder.min.js-vfl37lasZ.map