define(["require","exports","tslib","react","modules/clean/auth/login_or_register/types","modules/clean/downloads","modules/clean/react/copy_to_dropbox/modal","modules/clean/react/modal","modules/clean/react/share_download/api","modules/clean/storage","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/react/share_download/api"],(function(e,o,n,t,a,r,i,s,l,u,d,c,_,m,h,f){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),t=n.__importDefault(t),r=n.__importStar(r),l=n.__importStar(l),c=n.__importStar(c),o.direct=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var a,i,s;return n.__generator(this,(function(n){switch(n.label){case 0:return a=e.downloadTestUrl,i=e.url,[4,o.authModalHelpers.authenticateForDownload(t||null)];case 1:if(n.sent(),!a)return[3,5];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,l.testDownload(a)];case 3:return n.sent(),[3,5];case 4:return n.sent()instanceof f.TooLargeError?h.Notify.error(m.intl.formatMessage({id:"pcsTpL",defaultMessage:"The zip file is too large."})):h.Notify.error(m.intl.formatMessage({id:"pllUQE",defaultMessage:"Failed to download zip file."})),[2];case 5:return n.trys.push([5,7,,8]),[4,l.fetchDownloadUrl(i)];case 6:return s=n.sent(),r.get({url:s}),[3,8];case 7:return n.sent(),h.Notify.error(m.intl.formatMessage({id:"6OUwIN",defaultMessage:"Failed to download."})),[3,8];case 8:return[2]}}))}))},o.toDropbox=function(e,a,r,l,u){return n.__awaiter(this,void 0,void 0,(function(){var m,h;return n.__generator(this,(function(n){switch(n.label){case 0:return"anonymous"!==r?[3,2]:[4,o.authModalHelpers.authenticateForSaveToDropbox(u)];case 1:return m=n.sent(),h=c.reload,[3,4];case 2:return m=l?l.id:-1,_.assert(-1!==m,"role isn't anonymous => user cannot be null or undefined!"),d.Viewer.get_viewer().is_user_signed_in(l)?[3,4]:[4,o.authModalHelpers.doMultiAccountAuthentication(r)];case 3:n.sent(),n.label=4;case 4:return s.Modal.showInstance(t.default.createElement(i.CopyToDropboxModal,{shareToken:e,copyable:a,userId:m,role:r,onDismiss:h})),[2]}}))}))},o.authModalHelpers={authenticateForDownload:function(o){return o!==a.LoginOrRegisterKind.DOWNLOAD||u.LocalStorage.get("has_seen_download_signup_modal")?Promise.resolve():new Promise((function(r,i){var l=function(){u.LocalStorage.set("has_seen_download_signup_modal",!0),r()},d=function(){u.LocalStorage.set("has_seen_download_signup_modal",!0),i()};new Promise((function(o,n){e(["modules/clean/auth/login_or_register/modal"],o,n)})).then(n.__importStar).then((function(e){var n=e.LoginOrRegisterModal;s.Modal.showInstance(t.default.createElement(n,{downloadAction:a.DownloadAction.DIRECT_DOWNLOAD,id:"shared-link-download-signup-modal",initialMode:a.Mode.REGISTER,kind:o,onAuthenticateSuccess:l,onCancel:d,onContinueToView:l,signup_tag:"shmodel_download_register"}))}))}))},authenticateForSaveToDropbox:function(o){return new Promise((function(r,i){var l=function(e){return r(e.id)};new Promise((function(o,n){e(["modules/clean/auth/login_or_register/modal"],o,n)})).then(n.__importStar).then((function(e){var n=e.LoginOrRegisterModal;s.Modal.showInstance(t.default.createElement(n,{downloadAction:a.DownloadAction.SAVE_TO_DROPBOX,id:"shared-link-immediate-signup-modal",initialMode:a.Mode.REGISTER,kind:a.LoginOrRegisterKind.DOWNLOAD,onAuthenticateSuccess:l,onCancel:i,signup_tag:"shmodel_modal_register",encryptionOptions:o}))}))}))},doMultiAccountAuthentication:function(o){return new Promise((function(a,r){new Promise((function(o,n){e(["modules/clean/auth/multi_account_login_modal"],o,n)})).then(n.__importStar).then((function(e){var n=e.MultiAccountLoginModal;s.Modal.showInstance(t.default.createElement(n,{onAuthenticateSuccess:a,onCancel:r,role:o}))}))}))}}}));
//# sourceMappingURL=actions.min.js-vflIoIl-e.map